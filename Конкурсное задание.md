![PIC](https://github.com/Tiimgll/RCH2024-SPb/blob/main/topology.png)

| Устройство | Операционная система | Пользователь/Пароль |
|------------|-----------------------|---------------------|
| ISP        | Redos, AltLinux, Astra, Rosa Linux | student/student |
| RTR1       | Redos, AltLinux, Astra, Rosa Linux | student/student |
| RTR2       | Redos, AltLinux, Astra, Rosa Linux | student/student |
| SRV1       | Redos, AltLinux, Astra, Rosa Linux | student/student |
| SRV2       | Redos, AltLinux, Astra, Rosa Linux | student/student |
| CLI1       | Redos GUI, AltLinux GUI, Astra GUI, Rosa Linux GUI | student/student |
| CLI2       | Redos GUI, AltLinux GUI, Astra GUI, Rosa Linux GUI | student/student |


# Модуль Б. Настройка технических и программных средств информационно-коммуникационных систем

## Время на выполнение модуля: 5 часов

### Задания:

1. **Базовая настройка устройств**
    - Настройка имен устройств согласно топологии:
        - Используйте полное доменное имя, кроме ISP.
        - Используйте строчные буквы, кроме ISP.
    - Настройка адресации устройств согласно топологии:
        - Адрес сети согласно топологии:
            - Для RTR1 – последний адрес сети минус 1.
            - Для RTR2 – последний адрес сети минус 2.
            - Для SRV1 – первый адрес сети плюс 1.
            - Для SRV2 – первый адрес сети плюс 2.
            - Для CLI1 – десятый адрес сети.
            - Для CLI2 – двадцатый адрес сети.
        - Адрес шлюза по умолчанию:
            - Для SRV1 – адрес маршрутизатора RTR1.
            - Для SRV2 – адрес маршрутизатора RTR2.
            - Для CLI1 – адрес маршрутизатора RTR1.
            - Для CLI2 – адрес маршрутизатора RTR2.
        - DNS-суффикс – company.prof.
            - Используйте в качестве домена поиска.
        - Адрес DNS-сервера:
            - Для SRV1 – адрес маршрутизатора RTR1.
            - Для SRV2 – адрес маршрутизатора RTR2.
            - Для CLI1 – адрес маршрутизатора RTR1.
            - Для CLI2 – адрес маршрутизатора RTR2.
    - На всех устройствах, кроме CLI1 и CLI2, создайте пользователя sshadmin с паролем P@ssw0rd.
        - Пользователь sshadmin должен иметь возможность запуска утилиты sudo без дополнительной аутентификации (без ввода даже своего пароля).

2. **Настройка ISP**
    - Настройте адресацию на интерфейсах:
        - Интерфейс, подключенный к магистральному провайдеру, получает адрес по DHCP.
        - Интерфейс, к которому подключен RTR1, имеет адрес 11.11.11.1/24.
        - Интерфейс, к которому подключен RTR2, имеет адрес 22.22.22.1/24.
    - Настройте DHCP сервер:
        - Пул INET1:
            - Адрес сети – 11.11.11.0/24.
            - Выдаваемые адреса – 11.11.11.150 – 11.11.11.250.
            - Адрес шлюза по умолчанию – 11.11.11.1.
            - Адрес DNS-сервера – 11.11.11.1.
        - Пул INET2:
            - Адрес сети – 22.22.22.0/24.
            - Выдаваемые адреса – 22.22.22.150 – 22.22.22.250.
            - Адрес шлюза по умолчанию – 22.22.22.1.
            - Адрес DNS-сервера – 22.22.22.1.
    - Настройте перенаправляющий DNS сервер:
        - Все запросы должны пересылаться на внешний DNS сервер по адресу 8.8.8.8.
        - DNS сервер должен быть доступен по адресу 11.11.11.1 для RTR1.
        - DNS сервер должен быть доступен по адресу 22.22.22.1 для RTR2.
    - Настройте динамическую трансляцию адресов для сети 11.11.11.0/24 и 22.22.22.0/24.
        - RTR1 и RTR2 должны иметь выход в Интернет
    - Настройте возможность удаленного подключения по SSH с RTR1 и RTR2:
        - Пользователь для подключения sshadmin c паролем P@ssw0rd.
        - Адрес для подключения:
            - 11.11.11.1 для RTR1.
            - 22.22.22.1 для RTR2.
    - Настройте возможность отправки и получения ICMP запросов между RTR1 и RTR2 по внешним адресам.
        - Отправка и получение ICMP запросов на ISP должна быть запрещена.

3. **Настройка коммутации**
    - В качестве коммутатора используйте виртуальный коммутатор opennebula.
    - Убедитесь, что устройства достижимы друг друга.

4. **Настройка дисковой подсистемы**
    - На RTR1 настройте RAID массив:
        - Уровень дискового массива RAID 5.
        - Используйте имя дискового массива md1.
        - Используйте три неразмеченных жестких диска.
        - Используйте 100% дискового пространства.
        - Используйте файловую систему ext4.
        - Настройте автоматическое монтирование дискового массива.
        - Точка монтирования /opt/data.
    - На RTR2 сконфигурируйте LVM:
        - Используйте два неразмеченных жестких диска.
        - Создайте группу логических томов GV.
        - Создайте логический том ADAT.
        - Используйте 100% дискового пространства.
        - Используйте файловую систему ext4.
        - Настройте автоматическое монтирование тома.
        - Точка монтирования /opt/data.

5. **Установка и настройка сервера баз данных**
    - В качестве сервера баз данных используйте маршрутизатор RTR2.
    - Разверните сервер баз данных на базе MariaDB:
        - Пользователь root сервера баз данных должен иметь пароль P@ssw0rd.
        - Настройте возможность удаленного подключения к серверу баз данных пользователю root с паролем P@ssw0rd с любых адресов.
    - Разверните программное обеспечение для визуального управления базами данных adminer.
    - Проверьте корректность входа в adminer пользователя root с паролем P@ssw0rd.

6. **Настройка системы централизованного журналирования**
    - В качестве сервера системы централизованного журналирования используйте RTR2.
    - В качестве системы централизованного журналирования используйте Rsyslog совместно с веб панелью LogAnalyzer.
    - Настройте Rsyslog:
        - Настройте взаимосвязь сервера баз данных с Rsyslog.
            - В качестве сервера баз данных используйте MariaDB на RTR2
            - Имя базы данных: Sysloga
            - Пользователь базы данных: arsyslog
            - Пароль пользователя базы данных: rsyspwd
            - В базу данных должны записываться только сообщения об ошибках и более важные
        - Настройте возможность приема сообщений по протоколам TCP и UDP по порту 514.
    - Установите LogAnalyzer:
        - В качестве веб-сервера используйте Apache.
        - Файлы LogAnalyzer должны располагаться в папке /var/www/html/loganalyzer.
        - Используйте базу данных, с которой работает Rsyslog.
        - Веб панель LogAnalyzer должна быть доступна по адресу http://<IP адрес RTR2>/loganalyzer.
        - Для авторизации в веб панели LogAnalyzer необходимо использовать пользователя admin с паролем P@ssw0rd.
    - Настройте централизованный сбор журналов с хостов RTR1, SRV1, SRV2
        - Уровень журналирования – сообщения об ошибках и более важные
            - RTR1 использует протокол UDP
            - SRV1 и SRV2 использует протокол TCP


7. **Настройка системы централизованного мониторинга**
    - В качестве сервера системы централизованного мониторинга используйте RTR1.
    - В качестве системы централизованного мониторинга используйте сборщика prometheus и визуализатор grafana.
    - Система централизованного мониторинга должна быть доступна по адресу http://<IP адрес RTR1>:3000.
        - Администратором системы мониторинга должен быть пользователь admin с паролем P@ssw0rd.
        - Часовой пояс по умолчанию должен быть Europe/Moscow.
        - Разрешите самостоятельную регистрацию новых пользователей.
    - Настройте узел системы централизованного мониторинга, в качестве сборщика используйте prometheus node exporter:
        - В качестве узлов сети используйте устройства RTR2, SRV1, SRV2.
        - Имя узла сети должно соответствовать имени устройства.
        - Используйте дашборд, в котором будет видна загрузка ЦП, использование ОП, дисковой подсистемы всех перечисленных устройств. Остальные параметры мониторинга по желанию.

8. **Настройка SSH на управляемых серверах**
    - В качестве управляемых серверов используйте все устройства, кроме клиентов.
        - Доступ разрешен только пользователю sshadmin.
        - Доступ пользователю root запрещен в явном виде.
        - Доступ по паролю запрещен.
    - На CLI1 в каталоге /opt/keys сгенерируйте пару ключей с именем ans и ans.pub. Скопируйте публичный ключ на устройства.
    - Настройте подключение по SSH для пользователя sshadmin по соответствующему ключу.


# Модуль В. Автоматизация
## Время на выполнение модуля: 5 часов

### Задания:

1. **Настройка узла управления Ansible**
    - Настройте узел управления на базе CLI1.
        - Вам доступна документация на сайте [https://docs.ansible.com/](https://docs.ansible.com/).
    - Сформируйте инвентарь:
        - В каталоге /opt/ansible создайте файл инвентаря с именем hosts
            - Настройте запуск данного инвентаря по умолчанию.
        - Сформируйте группы серверов.
            - RTR1 – включается маршрутизатор RTR1.
            - RTR2 – включается маршрутизатор RTR2.
            - Router – включаются группы серверов RTR1 и RTR2.
            - SRV1 – включается сервер SRV1.
            - SRV2 – включается сервер SRV2.
            - Server – включаются группы серверов SRV1 и SRV2.
        - Реализуйте доступ к серверам с учетом настроек SSH.
            - Подключение осуществляется по пользователю sshadmin.
            - Подключение осуществляется по ключу.
            - Проверка ключей при подключении по SSH должна быть отключена
            - Для исключения предупреждений укажите корректный интерпретатор Python.
            - Все параметры должны быть размещены в папке group_vars в качестве переменных.
            - Выполните тестовые подключения, добавьте хосты в список известных.
        - Выполните тестовую команду “ping” средствами ansible
            - Убедитесь, что все сервера отвечают “pong” без предупреждающих сообщений.
            - Убедитесь, что команды ansible выполняются от пользователя user без использования sudo.
    - Создайте структуру каталогов.
        - В каталоге /opt/ansible создайте папку project_1
            - В папке project_1 создайте файл playbook_1.yml
            - В папке project_1 создайте файл playbook_2.yml
        - В каталоге /opt/ansible создайте папку project_2
            - В папке project_2 создайте файл playbook_1.yml
        - В каталоге /opt/ansible создайте папку project_3
            - В папке project_3 создайте файл playbook_1.yml
            - В папке project_3 создайте файл playbook_2.yml
        - В каталоге /opt/ansible создайте папку project_4
            - В папке project_4 создайте файл playbook_1.yml
            - В папке project_4 создайте файл playbook_2.yml
        - В каталоге /opt/ansible создайте папку project_5
            - В папке project_5 создайте файл playbook_1.yml
            - В папке project_5 создайте файл playbook_2.yml

2. **Настройка динамической трансляции адресов**
    - Настройте динамическую трансляцию адресов средствами Ansible для группы серверов RTR1.
        - В качестве плейбука используйте файл playbook_1.yml в каталоге project_1.
        - Плейбук должен содержать действия по настройке динамической трансляцию адресов.
            - Используйте firewalld.
            - Для внешнего интерфейса используйте зону external.
            - Обеспечьте автоматическое восстановление правил после перезагрузки.
            - Использование плагина shell и command НЕ допускается
                - Использование запрещенных плагинов обнулит весь пункт при проверке.
    - Настройте динамическую трансляцию адресов средствами Ansible для группы серверов RTR2.
        - В качестве плейбука используйте файл playbook_2.yml в каталоге project_1.
        - Плейбук должен содержать действия по настройке динамической трансляцию адресов.
            - Используйте iptables.
            - Обеспечьте автоматическое восстановление правил после перезагрузки.
            - Использование плагина shell и command НЕ допускается.
                - Использование запрещенных плагинов обнулит весь пункт при проверке.

3. **Настройка перенаправляющего DNS**
    - Настройте перенаправляющий DNS средствами Ansible для группы серверов Router.
        - В качестве плейбука используйте файл playbook_1.yml в каталоге project_2.
        - Плейбук должен содержать действия по настройке перенаправляющего DNS.
            - Используйте bind9.
            - Прослушивается только адрес 127.0.0.1 и адрес внутреннего интерфейса.
            - Все запросы должны пересылаться внешнему DNS-серверу.
                - Для RTR1 на 77.88.8.8.
                - Для RTR2 на 77.88.8.1.
            - Сервер должен только перенаправлять все запросы и не пытаться разрешить их самостоятельно.
            - Использование плагина shell и command НЕ допускается.
                - Использование запрещенных плагинов обнулит весь пункт при проверке.
        - Плейбук должен содержать действия по перенастройке адреса DNS-сервера на маршрутизаторах на 127.0.0.1.
            - Использование плагина shell и command НЕ допускается.
                - Использование запрещенных плагинов обнулит весь пункт при проверке.

4. **Настройка протокола динамической конфигурации хостов**
    - Настройте протокол динамической конфигурации хостов средствами Ansible для группы серверов RTR1.
        - В качестве плейбука используйте файл playbook_1.yml в каталоге project_3.
        - Плейбук должен содержать действия по настройке протокола динамической конфигурации хостов.
            - Адрес сети – согласно топологии.
            - Адрес шлюза по умолчанию – адрес маршрутизатора RTR1.
            - DNS-суффикс – company.prof.
            - Адрес DNS-сервера – адрес маршрутизатора RTR1.
            - Адрес NTP-сервера – адрес маршрутизатора RTR1.
            - Выдаваемые адреса:
                - Первый адрес – первый адрес сети плюс 5.
                - Последний адрес – общее количество адресов в сети разделенное на 2.
            - Использование плагина shell и command НЕ допускается.
                - Использование запрещенных плагинов обнулит весь пункт при проверке.
    - Настройте протокол динамической конфигурации хостов средствами Ansible для группы серверов RTR2.
        - В качестве плейбука используйте файл playbook_2.yml в каталоге project_3.
        - Плейбук должен содержать действия по настройке протокола динамической конфигурации хостов.
            - Адрес сети – согласно топологии.
            - Адрес шлюза по умолчанию – адрес маршрутизатора RTR2.
            - DNS-суффикс – company.prof.
            - Адрес DNS-сервера – адрес маршрутизатора RTR2.
            - Адрес NTP-сервера – адрес маршрутизатора RTR2.
            - Выдаваемые адреса:
                - Первый адрес – общее количество адресов в сети разделенное на 2 плюс 1.
                - Последний адрес – последний адрес сети минус 5.
            - Использование плагина shell и command НЕ допускается.
                - Использование запрещенных плагинов обнулит весь пункт при проверке.
    - Переконфигурируйте сетевые настройки на CLI2 для получения сетевых параметров по DHCP.
        - Применение Ansible НЕ требуется.

5. **Настройка сервера времени**
    - Настройте сервер времени средствами Ansible для группы серверов Router
        - В качестве плейбука используйте файл playbook_1.yml в каталоге project_4
        - Плейбук должен содержать действия по установке и настройке сервера времени
            - Используйте сервер времени на базе Chrony
            - Используйте стратум 4
            - Используйте внешний сервер синхронизации времени:
            - ntp2.vniiftri.ru для RTR1
            - ntp3.vniiftri.ru для RTR2
            - Сервер допускает синхронизацию времени только для сети LAN
            - Используйте часовой пояс Europe/Moscow
            - Использование плагина shell и command НЕ допускается

6. **Настройка NTP клиента**
    - Настройте NTP клиента средствами Ansible для группы серверов Server
        - В качестве плейбука используйте файл playbook_2.yml в каталоге project_4
        - Проект должен содержать действия по установке и настройке NTP клиента
            - Используйте NTP клиент на базе Chrony
            - Используйте часовой пояс Europe/Moscow
            - Устройства должны синхронизировать время:
            - Первый сервер RTR1
            - Второй сервер RTR2
            - Использование плагина shell и command НЕ допускается

7. **Настройка NFS сервера**
    - Настройте NFS сервер средствами Ansible для группы маршрутизаторов Router
        - В качестве плейбука используйте файл playbook_1.yml в каталоге project_5
            - Плейбук должен содержать действия по настройке NFS сервера
            - Настройте общий доступ к директории /opt/data
            - Общий доступ должен быть обеспечен для чтения и записи только для устройств локальной сети

8. **Настройка NFS клиента**
    - Настройте NFS клиента средствами Ansible для группы серверов Server
        - В качестве плейбука используйте файл playbook_2.yml в каталоге project_5
        - Плейбук должен содержать действия по настройке NFS клиента
            - На SRV1 настройте автоматическое подключение NFS каталога
            - Используйте локальную точку монтирования /mnt/data
            - Используйте общую папку на RTR1
            - На SRV2 настройте автоматическое подключение NFS каталога
            - Используйте локальную точку монтирования /mnt/data
            - Используйте общую папку на RTR2


# Модуль Г. Обеспечение отказоустойчивости
## Время на выполнение модуля: 5 часов

### Задания:

1. **Настройка отказоустойчивости динамической трансляции адресов**
    - Группа серверов VRRP включает в себя маршрутизаторы RTR1 и RTR2
    - Создайте группу серверов Keepalived со следующими параметрами:
        - Имя группы – NAT
        - Иерархия группы - RTR1 -> RTR2
        - Идентификатор группы – 69
        - Приоритет - 110 и 100 соответственно
        - Виртуальный адрес группы - последний адрес сети
        - Интервал рассылки сообщений - 1 секунда
        - Время, после которого сервер с более высоким приоритетом заберет обратно себе роль мастера – 30 секунд
    - Обеспечьте автозапуск конфигурации
    - Переконфигурируйте сетевые настройки SRV1 и SRV2 c учетом настроек отказоустойчивости динамической трансляции адресов

2. **Настройка отказоустойчивости перенаправляющего DNS**
    - Группа серверов VRRP включает в себя маршрутизаторы RTR1 и RTR2
    - Создайте группу серверов Keepalived со следующими параметрами:
        - Имя группы – DNS
        - Иерархия группы - RTR1 -> RTR2
        - Идентификатор группы – 53
        - Приоритет - 110 и 100 соответственно
        - Виртуальный адрес группы - последний адрес сети
        - Интервал рассылки сообщений - 1 секунда
        - Время, после которого сервер с более высоким приоритетом заберет обратно себе роль мастера – 30 секунд
    - Обеспечьте автозапуск конфигурации
    - Внесите изменения в настройки перенаправляющих DNS с учетом работы keepalived

3. **Настройка отказоустойчивости сервера времени**
    - Группа серверов VRRP включает в себя маршрутизаторы RTR1 и RTR2
    - Создайте группу серверов Keepalived со следующими параметрами:
        - Имя группы – NTP
        - Иерархия группы – RTR1 -> RTR2
        - Идентификатор группы – 123
        - Приоритет - 110 и 100 соответственно
        - Виртуальный адрес группы - последний адрес сети
        - Интервал рассылки сообщений - 1 секунда
        - Время, после которого сервер с более высоким приоритетом заберет обратно себе роль мастера – 30 секунд
    - Обеспечьте автозапуск конфигурации

4. **Настройка балансировки и отказоустойчивости DHCP сервера**
    - Используйте внутренние сервисы для управления коллективной работой службы DHCPD (failover)
    - Используйте следующие роли для DHCP серверов:
        - RTR1 – primary
        - RTR2 – secondary
    - Используйте следующую конфигурацию взаимодействия DHCP серверов
        - Таймаут, по истечении которого сервер считается не рабочим - 60 секунд
        - Количество запросов, которые могут быть отправлены без обязательного подтверждения – 10
        - Время, в течение которого DHCP сервер будет ждать восстановления канала связи с партнёром – 3600 секунд
        - Индекс разделения работы между DHCP серверами – 128
        - Время, по истечении которого прекращается работа балансировки и сервер отвечает самостоятельно - 3 секунды
    - Переконфигурируйте DHCP сервера для работы failover с учетом отказоустойчивости NAT, DNS, NTP и FreeIPA
        - Имя пира – DHCP
        - Выдаваемые адреса:
            - Первый адрес – первый адрес сети плюс 5
            - Последний адрес – последний адрес сети минус 5
        - Адрес NTP-сервера – адреса доменных NTP серверов  
    - Переконфигурируйте сетевые настройки на CLI1 и CLI2 для получения сетевых параметров по DHCP
        - Проверьте работоспособность DHCP failover на клиентах
    - Клиенты CLI1 и CLI2 должны получать параметры NTP сервера по DHCP
        - Используйте NTP клиент на базе Chrony
        - Используйте часовой пояс Europe/Moscow

5. **Настройка отказоустойчивой системы централизованного управления авторизацией пользователей**
    - Разверните систему централизованного управления авторизацией пользователей
        - Разверните домен на базе FreeIPA
            - Основной сервер - SRV1
            - Дополнительный сервер (реплика) - SRV2
        - Имя домена - company.prof
        - DNS сервер - интегрированный с IPA
            - Запросы, которые выходят за рамки зоны, пересылаются на виртуальный адрес перенаправляющего DNS-сервера
            - Обратная зона - согласно топологии
            - Все устройства сети должны быть доступны по имени
        - CA сервер - интегрированный с IPA
            - Клиенты домена должны доверять центру сертификации
        - NTP сервер - интегрированный с IPA
            - NTP сервер должен синхронизировать время с отказоустойчивым сервером времени
        - Пароль администратора домена - P@ssw0rd
    - Настройте систему централизованного управления авторизацией пользователей
        - Создайте пользователей user1, user2 и mon с паролем P@ssw0rd, 
        - Пользователей user1, user2 включите в группу prof
        - Пользователя mon включите в группу admins
        - Создайте правило admin_sudo, разрешающее группе пользователей admins использовать sudo на всех компьютерах в домене без ограничения.
        - Обеспечьте доменному пользователю admin, после успешной авторизации на клиентах, возможность заходить в интерфейс FreeIPA без использования пароля. Для аутентификации и авторизации используйте Kerberos.
            - Используйте Яндекс браузер
    - Клиентов CLI1 и CLI2 введите в домен FreeIPA 
    - Настройте подключение к системе централизованного мониторинга с использованием FreeIPA
        - Используйте адрес системы централизованного мониторинга http://mon.company.prof:3000
        - Используйте LDAP в качестве аутентификацию по умолчанию
            - В настройках LDAP укажите все имеющиеся серверы
        - Используйте доменного пользователя mon
            - Группа – grafana_admin
            - Тип пользователя – admin
